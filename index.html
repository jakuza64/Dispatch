<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Dispatch Demo</title>
  
</head>
  <script src="pixi/pixi.min.js"></script>
  <script src="src/text.js"></script>
  <script src="src/button.js"></script>
  <script src="src/clock.js"></script>
<body>
  <style>* {padding: 0; margin: 0}</style>
  <script type="text/javascript">
    //Aliases
    let Application = PIXI.Application,
        loader = PIXI.loader,
        resources = PIXI.loader.resources,
        Sprite = PIXI.Sprite;

    //Create a Pixi Application
    let app = new PIXI.Application({ 
        antialias: true,   // default: false
        backgroundColor : 0x161B1C
      }
    );

    //Add the canvas that Pixi automatically created for you to the HTML document
    document.body.appendChild(app.view);

    //loading google fonts
    window.WebFontConfig = {
        google: {
            families: ['VT323']
        },

        active: function() {
            // do something
            init();
        }
    };

    // include the web-font loader script
    /* jshint ignore:start */
    (function() {
        var wf = document.createElement('script');
        wf.src = ('https:' === document.location.protocol ? 'https' : 'http') +
            '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
        wf.type = 'text/javascript';
        wf.async = 'true';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(wf, s);
    })();
    /* jshint ignore:end */



    function init() {

        //adding police seal sprite
        loader
          .add("images/police_seal.png")
          .load(setup);

        //defining global variables
        let titleText,
            titleIcon,
            testButton,
            state,
            clock,
            clockText,
            simpleBool = false;

        //This `setup` function will run when the image has loaded
        function setup() {

            //setting to fullscreen
            app.renderer.view.style.position = "absolute";
            app.renderer.view.style.display = "block";
            app.renderer.autoResize = true;
            app.renderer.resize(window.innerWidth, window.innerHeight);
            
            //Setup game scenes
            gameScene = new PIXI.Container();
            app.stage.addChild(gameScene);
          
            pauseScene = new PIXI.Container();
            app.stage.addChild(pauseScene);
    
            gameScene.visible = true;
            pauseScene.visible = false;

            //initialize title text
            titleText = new Text('D I S P A T C H \n _____________', true, 0, 195, 60);
            gameScene.addChild(titleText.textObj);

            //initialize pause text
            pauseText = new Text('P A U S E D \n _________', true, 0, 512, 256);
            pauseScene.addChild(pauseText.textObj);

            //Create the seal sprite
            titleIcon = new Sprite(resources["images/police_seal.png"].texture);
            titleIcon.position.set(100,100);
            titleIcon.anchor.set(0.5,0.5);
            app.stage.addChild(titleIcon);            

            //Create a couple buttons underneath
            testButton = new Button('BUTTON', test, true, 195, 140);
            gameScene.addChild(testButton.button);
            testButton2 = new Button('AND ANOTHA ONE', test2, true, 195, 180);
            gameScene.addChild(testButton2.button);

            //set the game state to play and initialize the game clock (and its text and pause button)
            state = loopPlay;
            clock = new Clock(20);
            clockText = new Text('', true, 1, app.screen.width - 120, app.screen.height - 40);

            app.stage.addChild(clockText.textObj);
            pauseButton = new Button('//', togglePause, true, app.screen.width - 160, app.screen.height - 40);
            app.stage.addChild(pauseButton.button);



            //start the game loop, finishing setup
            app.ticker.add(delta =>  gameLoop(delta));
        };

        function gameLoop(delta) {

            //Update the current game state
            state(delta);
        };

        function loopPlay(delta) {
            
            clock.iterate(delta);
            clockText.setText(clock.humanizeCurrentTime());
        };

        function loopPaused(delta) {

            //do nothing
        }

        function test() {

            simpleBool = !simpleBool;
            if (simpleBool) titleText.setText('S P A G H E T T I \n _______________');
            else titleText.setText('D I S P A T C H \n _____________');
        }

        function test2() {

            alert('ALERT');
        }

        function togglePause() {
            if (state == loopPlay) {
                state = loopPaused;
                gameScene.visible = false;
                pauseScene.visible = true;
                pauseButton.setText('>', true);
            }
            else if (state == loopPaused) {
                state = loopPlay;
                gameScene.visible = true;
                pauseScene.visible = false;
                pauseButton.setText('//', true);
            }
            
        }

        
    };
    

    

  </script>
</body>
</html>